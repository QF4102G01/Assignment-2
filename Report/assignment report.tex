% This is a comment.
% the region directly below this comment, up till the command \begin{document} is known as the 'preamble'
% basic setup
\documentclass{article}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}

% for mathematics
\usepackage{amsmath}
\usepackage{amsthm}
% define theorems, lemmas, etc
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\newtheorem{definition}{Definition}
\newtheorem{example}{Example}
\usepackage{amssymb}

% for adjusting margins
\usepackage{geometry}
\geometry{
	a4paper,
 	left=26mm,
 	right=20mm,
 	top=33mm,
 	bottom=38mm
}

% for introducing urls
\usepackage{url}

% for colored text
\usepackage{color}

% for creating lists
\usepackage{enumerate}

% for import graphics
\usepackage{graphicx}

% include algorithm package
\usepackage[]{algorithm2e}

% change font to times new roman
%\usepackage{times}

% add padding to in between paragraphs
\setlength{\parskip}{1em}

% eliminate indent at start of paragraph
\setlength\parindent{0pt}

% title details
\title{QF4102 Financial Modelling and Computation Assignment 2}
%\date{}
\author{G01 Wang Zexin, Chen Penghao}

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
\begin{document}

% insert title
\maketitle
% make a new page
\newpage

\section{Forward Grid Shooting Method on American floating-strike arithmetic-average call}
\subsection*{\emph{Statement of the problem}}
Write a MatLab function to calculate the American fixed-strike arithmetic-average put option value using Forward Shooting Grid Method with linear interpolation.

\subsection{FSGM for American fixed-strike arithmetic-average put option}

\begin{algorithm}[H]
	\KwData{runningTime, $\tau$, $S_0$, $\sigma$, $q$, $A$(running average), $r$, $K$, $N$, $\rho$}
	\KwResult{$P_{FSGM}$, Option Premium}
	$\Delta t$ = $\dfrac{\tau}{N}$;
	$\Delta x = \sigma \sqrt{\Delta t}$;
	$\Delta y = \rho \Delta x$\;
	$u = e^{\Delta x}$;
	$d = e^{-\Delta x}$;
	$p = \dfrac{e^{(r-q) \Delta t} - d}{u - d}$\;
	\For {$j = 0$ to $N$} {
		\For {$k = \dfrac{-N}{\rho}$ to $\dfrac{N}{\rho}$} {
			$v(j, k) = max(K - A \exp(k \Delta y))$;
		}
	}
	\For {$n = N-1$ to $1$} {
		\For {$j = 0$ to $n$} {
			\For {$k = -\frac{n}{\rho}, -frac{n}{\rho}+1, \dots, \frac{n}{\rho}$} {
				$S = S_{0} \exp[(2j - n) * \Delta x]$\;
				$A' = A \exp(k \Delta x)$\;
				$A_{up} = \frac{A' (n + runningN) + Su}{n + runningN + 1}$\;
				$A_{down} = \frac{A' (n + runningN) + Sd}{n + runningN + 1}$\;
				$k_{u} = floor(\frac{ln(\frac{A_{up}}{A})}{\Delta y})$\;
				$k_{d} = floor(\frac{ln(\frac{A_{down}}{A})}{\Delta y})$\;
				$v_{u} = \Pi v(A_{k_{u}}, S_{u})$\;
				$v_{d} = \Pi v(A_{k_{d}}, S_{d})$\;
				$v(j,k) = \max(\exp(-r \Delta t) * (pv_{u} + (1-p)v_{d}), K - A')$;
			}
		}
	}
\caption{Algorithm for pricing American arithmetic-Asian put}
\end{algorithm}

The American fixed-strike arithmetic-average put option is initiated 0.25 year ago, and has 0.25 year more to expiry. The underlier price is currently $\$100$, volatility $40$ and dividend yield 0.01 with a running average of $\$95$, which was taken over the earlier 0.25 year since launched. The risk-free rate $r_f$ is $0.1$ and strike price $K=
\$100$.

Compute the option value with $\rho=1$, $\rho=\dfrac{1}{2}$ and $\rho = \dfrac{1}{5}$. For each $\rho$, the number of periods in the lattice is required to be 50, 100, 200 and 400. Compare the computed results and the computation times taken.

We use the forward shooting grid method which on each grid point representing one underlying price and one current time, has an array to represent the option value based on different values of running average. The running average values branch out from the previous running average, which was a weighted average with the starting price of the underlying security. The stock price values branch out from the starting price of the underlying asset.

\subsection{Comment on the numerical results and computation times taken for different $\rho$ and $N$ values}
The different amoung of time taken and option prices for various set of $\rho$ and $N$ is shown below:

\hspace{23mm} When $\rho=1$:
\begin{center}
	\begin{tabular}{| c | c | c | c |}
		\hline $\rho$ & $N$ & Option price & Time taken in $\mu s$\\
		[0.5ex]
		\hline 1 & 50 & 5.3942(\textbf{this value has been updated, if not correct please call 86984390}) & 0.26287 \\
		\hline 1 & 100 & 5.4178 & 2.649 \\
		\hline 1 & 200 & 5.4428 & 16.86 \\
		\hline 1 & 400 & 5.4553 & 139.52 \\
		\hline
	\end{tabular}
\end{center}

\hspace{23mm} When $\rho=0.5$:
\begin{center}
	\begin{tabular}{| c | c | c | c |}
		\hline $\rho$ & $N$ & Option price & Time taken in $\mu s$\\
		[0.5ex]
		\hline 0.5 & 50 & 5.3456 & 0.60326 \\
		\hline 0.5 & 100 & 5.4058 & 3.9802 \\
		\hline 0.5 & 200 & 5.4361 & 31.521 \\
		\hline 0.5 & 400 & 5.4509 & 299.12 \\
		\hline
	\end{tabular}
\end{center}

\hspace{23mm} When $\rho=0.2$:
\begin{center}
	\begin{tabular}{| c | c | c | c |}
		\hline $\rho$ & $N$ & Option price & Time taken in $\mu s$\\
		[0.5ex]
		\hline 0.2 & 50 & 5.3391 & 2.1132 \\
		\hline 0.2 & 100 & 5.3992 & 12.573 \\
		\hline 0.2 & 200 & 5.4318 & 92.8 \\
		\hline 0.2 & 400 & 5.4487 & 760.81 \\
		\hline
	\end{tabular}
\end{center}

Regarding the option value, using the same $\rho$ value, as $N$ increases, the estimated option value increases from $N = 50$ to $N = 400$. 

\subsection{FSGM for American fixed-strike lookback put option}
Next, an American fixed-strike lookback put option is concerned, initiated 0.25 year ago, and still having 0.25 year to expiry. The current underlier price $S_{0.25}=\$1$, volatility $\sigma=40\%$ and dividend yield $q = 0.01$. The running minimum is at $\$0.97$ which was taken over the earlier period of 0.25 year. The risk-free rate $r_f=0.1$ and strike $K=\$0.95$.

\begin{algorithm}[H]
	\KwData{runningTime, $\tau$, $S_0$, $\sigma$, $q$, $A$(running minimum), $r$, $K$, $N$}
	\KwResult{$P_{FSGM}$, Option Premium}
	$\Delta t$ = $\dfrac{\tau}{N}$;
	$\Delta x = \sigma \sqrt{\Delta t}$;
	$u = e^{\Delta x}$;
	$d = e^{-\Delta x}$;
	$p = \dfrac{e^{(r-q) \Delta t} - d}{u - d}$\;
	\For {$j = 0$ to $N$} {
		\For {$k = \dfrac{-N}{\rho}$ to $\dfrac{N}{\rho}$} {
			$v(j, k) = max(K - A \exp(k \Delta x))$;
		}
	}
	\For {$n = N-1$ to $1$} {
		\For {$j = 0$ to $n$} {
			\For {$k = -\frac{n}{\rho}, -frac{n}{\rho}+1, \dots, \frac{n}{\rho}$} {
				$S = S_{0} \exp[(2j - n) * \Delta x]$\;
				$A' = A \exp(k \Delta x)$\;
				$A_{up} = \min(A', Su)$\;
				$A_{down} = \min(A', Sd)$\;
				$k_{u} = round(\ln(\frac{A_{up}}{A}) / \Delta x)$\;
				$k_{d} = round(\ln(\frac{A_{down}}{A}) / \Delta x)$\;
				$v_{u} = v(A\exp(k_{u}\Delta x), Su)$\;
				$v_{d} = v(A\exp(k_{d}\Delta x), Sd)$\;
				$v(j,k) = \max(\exp(-r \Delta t) * (pv_{u} + (1-p)v_{d}), K - A')$;
			}
		}
	}
\caption{Algorithm for pricing American lookback put}
\end{algorithm}

We use the forward shooting grid method which on each grid point representing one underlying price and one current time. Different from the algorithm for Asian option, we are not using array to represent different values of running minimum on each grid point, and we are not interpolating to obtain to value shot from each grid point. The stock price values branch out from the starting price of the underlying asset.

\subsection{Comment on the numerical results and computation times taken for different $N$ values}
Compute the function for number of time periods $N = 50$ to $N = 500$ with increments of 50, and comment on the numerical results and computation time taken. Lastly, re-run the algorithm with running minimum changed from $\$0.97$ to $\$0.57$.

\subsection{Comment on the numerical results obtained from lower running minimum value}
The option values for the running minimum of $\$0.57$ is always $\$0.38$, because the current underlying asset price $\$1$ is too high that it is highly improbable for the future underlier price to be lower than the running minimum, and it is more beneficial to exercise the option immediately at the current time.

\section{Explicit Difference Scheme III for vanilla call option}
\subsection*{\emph{Statement of the problem}}
Write a MatLab function to implement the explicit difference scheme III for pricing European vanilla calls. Test the algorithm out with a European vanilla call option with strike $K = \$9$, time to maturity $0.25$ year, current underlier price $S = \$9.8$, volatility $\sigma=0.15$. The dividend yield $q = 1\%$ and risk-free rate is $0.1\%$.

\subsection{Newly issued European floating strike lookback put options}

\subsection{Previously issued European floating strike lookback put options}

\subsection{Analyze, compare and comment on the results}

\end{document}